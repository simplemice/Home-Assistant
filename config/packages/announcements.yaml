###############################################################################
#   @author         :   Simplemice
#   @date           :   27/01/2024
#   @package        :   Announcements
#   @description    :   Daily Announcements.
###############################################################################

automation:
  - id: 81bee5ee-6820-4626-aebf-3deb8de69e4d
    alias: Turn On Audible Notifications
    initial_state: true
    trigger:
      platform: template
      value_template: "{{ states('sensor.time') == (state_attr('input_datetime.audible_notification_on', 'timestamp') | int | timestamp_custom('%H:%M', False)) }}"
    action:
      - service: input_boolean.turn_on
        entity_id: input_boolean.audible_notifications

  - id: e0e9c774-6abe-42aa-bdab-32108bebb0e9
    alias: Turn Off Audible Notifications
    initial_state: true
    trigger:
      - platform: template
        value_template: "{{ states('sensor.time') == (state_attr('input_datetime.audible_notification_off', 'timestamp') | int | timestamp_custom('%H:%M', False)) }}"
    condition:
      - condition: state
        entity_id: input_boolean.audible_notifications
        state: "on"
    action:
      - service: input_boolean.turn_off
        entity_id: input_boolean.audible_notifications

  - id: kitchen_water_low
    alias: "Notification - Kitchen Water Tank low"
    description: ""
    trigger:
      - type: value
        platform: device
        device_id: 9be7b2d13e72b6683f75158901d19ea5
        entity_id: e46e9bc06cadd14b8a18f9eebe612743
        domain: sensor
        below: 15
    condition:
      - condition: time
        after: "08:00:00"
        before: "22:00:00"
    action:
      - choose:
          - conditions:
              - condition: and
                conditions:
                  - condition: state
                    entity_id: person.simplemice
                    state: home
                  - condition: state
                    entity_id: input_boolean.audible_notifications
                    state: "on"
            sequence:
              - repeat:
                  sequence:
                    - service: notify.alexa_media_bedroom_speaker
                      data:
                        message: |
                          {{ [
                              "Warning: Water tank level is low. Consider refilling it to ensure a continuous water supply.",
                              "Alert: The water tank is running low. Please check and refill to avoid interruptions.",
                              "Low water level detected! Ensure the water tank is replenished to avoid disruptions.",
                              "Attention: Water tank is nearly empty. Refill to maintain a sufficient water supply.",
                              "Urgent: Low water level in the tank. Take action to prevent any water shortages.",
                              "Water supply alert: The tank is low. Check and refill to avoid inconvenience.",
                              "Critical: Water tank level is low. Refill promptly to ensure a continuous water supply."
                            ] | random }}
                    - delay:
                        hours: 0
                        minutes: 10
                        seconds: 0
                        milliseconds: 0
                  until:
                    - type: is_value
                      condition: device
                      device_id: 9be7b2d13e72b6683f75158901d19ea5
                      entity_id: e46e9bc06cadd14b8a18f9eebe612743
                      domain: sensor
                      above: 30
          - conditions:
              - condition: and
                conditions:
                  - condition: state
                    entity_id: input_boolean.text_notifications
                    state: "on"
                  - condition: or
                    conditions:
                      - condition: state
                        entity_id: person.simplemice
                        state: not_home
                      - condition: state
                        entity_id: person.simplemice
                        state: "Monkey Office"
            sequence:
              - repeat:
                  sequence:
                    - service: notify.simplemice
                      data:
                        message: |
                          {{ [
                              "Warning: Water tank level is low. Consider refilling it to ensure a continuous water supply.",
                              "Alert: The water tank is running low. Please check and refill to avoid interruptions.",
                              "Low water level detected! Ensure the water tank is replenished to avoid disruptions.",
                              "Attention: Water tank is nearly empty. Refill to maintain a sufficient water supply.",
                              "Urgent: Low water level in the tank. Take action to prevent any water shortages.",
                              "Water supply alert: The tank is low. Check and refill to avoid inconvenience.",
                              "Critical: Water tank level is low. Refill promptly to ensure a continuous water supply."
                            ] | random }}
                    - delay:
                        hours: 0
                        minutes: 10
                        seconds: 0
                        milliseconds: 0
                  until:
                    - type: is_value
                      condition: device
                      device_id: 9be7b2d13e72b6683f75158901d19ea5
                      entity_id: e46e9bc06cadd14b8a18f9eebe612743
                      domain: sensor
                      above: 30

  - id: rain_outside
    alias: Notification - Rain Outside
    description: ""
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.rain_sensor
        to: "on"
    condition:
      - condition: time
        after: "08:00:00"
        before: "20:00:00"
    action:
      - service: notify.alexa_media_bedroom_speaker
        data:
          message: <audio src="soundbank://soundlibrary/weather/thunder/thunder_10"/>
          data:
            type: tts
      - delay:
          hours: 0
          minutes: 0
          seconds: 2
          milliseconds: 0
      - choose:
          - conditions:
              - condition: state
                entity_id: input_boolean.audible_notifications
                state: "on"
            sequence:
              - service: notify.alexa_media_bedroom_speaker
                data:
                  message: |
                    {{ [
                        "Rain alert: It's currently raining outside. Take necessary precautions when heading outdoors.",
                        "Attention: Rain detected outside. Don't forget your umbrella if you plan to go out.",
                        "Rainy weather: It's currently raining. Consider adjusting your plans accordingly.",
                        "Weather update: Rain is falling outside. Stay dry and be cautious on the roads.",
                        "Umbrella time: Rain detected outside. Grab an umbrella before heading out.",
                        "Rainfall alert: It's raining. Make sure to check the weather conditions before going outside.",
                        "Rainy day reminder: The weather outside is rainy. Take appropriate measures for your activities."
                    ] | random }}
          - conditions:
              - condition: state
                entity_id: input_boolean.text_notifications
                state: "on"
            sequence:
              - service: notify.simplemice
                data:
                  message: TTS
                  data:
                    media_stream: alarm_stream_max
                    tts_text: |
                      {{ [
                          "Rain alert: It's currently raining outside. Take necessary precautions when heading outdoors.",
                          "Attention: Rain detected outside. Don't forget your umbrella if you plan to go out.",
                          "Rainy weather: It's currently raining. Consider adjusting your plans accordingly.",
                          "Weather update: Rain is falling outside. Stay dry and be cautious on the roads.",
                          "Umbrella time: Rain detected outside. Grab an umbrella before heading out.",
                          "Rainfall alert: It's raining. Make sure to check the weather conditions before going outside.",
                          "Rainy day reminder: The weather outside is rainy. Take appropriate measures for your activities."
                      ] | random }}
      - service: select.select_option
        target:
          entity_id: select.wled_matrix_preset
        data:
          option: Lightning
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: notify.alexa_media_bedroom_speaker
        data:
          message: <audio src="soundbank://soundlibrary/weather/thunder/thunder_10"/>
          data:
            type: tts
      - delay:
          hours: 0
          minutes: 0
          seconds: 15
          milliseconds: 0
      - service: select.select_option
        data:
          option: Black Hole
        target:
          entity_id: select.wled_matrix_preset

  - id: cooking_complete
    alias: Notification - Cooking Complete
    description: ""
    trigger:
      - platform: state
        entity_id:
          - sensor.careli_maf01_68e5_air_fryer
        from: cooking
        to: shutdown
      - platform: state
        entity_id:
          - sensor.careli_maf01_68e5_air_fryer
        from: cooking
        to: standby
      - platform: state
        entity_id:
          - sensor.careli_maf01_68e5_air_fryer
        to: cooked
        from: cooking
      - platform: state
        entity_id:
          - sensor.chunmi_n23l01_bcf8_oven
        from: cooking
        to: cook finish
      - platform: state
        entity_id:
          - sensor.chunmi_eh3_e09c_cooker
        from: running
        to: keepwarm
      - platform: state
        entity_id:
          - sensor.chunmi_eh3_e09c_cooker
        from: running
        to: idle
      - platform: event
        event_type: timer.finished
        event_data:
          entity_id: timer.cooking_timer
    condition:
      - condition: time
        after: "08:00:00"
        before: "20:00:00"
    action:
      - choose:
          - conditions:
              - condition: state
                entity_id: input_boolean.audible_notifications
                state: "on"
            sequence:
              - service: notify.alexa_media_bedroom_speaker
                data:
                  message: |
                    {{ [
                        "Dinner is served! Cooking is complete. Enjoy your meal!",
                        "Good news: Cooking is done! Your delicious meal is ready to be savored.",
                        "Chef's masterpiece: Cooking is complete. Your meal is now ready for enjoyment.",
                        "Cooking success: Your culinary creation is complete. Time to feast!",
                        "Ding! Cooking is finished. Your meal is hot and ready.",
                        "Culinary triumph: The cooking process is complete. Bon appétit!",
                        "Cooking achievement unlocked! Your meal is ready to be enjoyed."
                    ] | random }}
          - conditions:
              - condition: state
                entity_id: input_boolean.text_notifications
                state: "on"
            sequence:
              - service: notify.simplemice
                data:
                  message: |
                    {{ [
                        "Dinner is served! Cooking is complete. Enjoy your meal!",
                        "Good news: Cooking is done! Your delicious meal is ready to be savored.",
                        "Chef's masterpiece: Cooking is complete. Your meal is now ready for enjoyment.",
                        "Cooking success: Your culinary creation is complete. Time to feast!",
                        "Ding! Cooking is finished. Your meal is hot and ready.",
                        "Culinary triumph: The cooking process is complete. Bon appétit!",
                        "Cooking achievement unlocked! Your meal is ready to be enjoyed."
                    ] | random }}
      - service: input_boolean.turn_off
        data: {}
        target:
          entity_id: input_boolean.cooking_timer_finish

  - id: door_knock
    alias: Notification - Garage Door Knock
    description: ""
    trigger:
      - platform: state
        entity_id:
          - binary_sensor.livingroom_door_knock_vibration
        to: "on"
    condition:
      - condition: and
        conditions:
          - condition: state
            entity_id: person.simplemice
            state: home
          - condition: state
            entity_id: switch.livingroom_curtains
            state: "off"
          - condition: time
            after: "08:00:00"
            before: "22:00:00"
    action:
      - service: xiaomi_aqara.play_ringtone
        data:
          gw_mac: 04:CF:8C:A9:DA:39
          ringtone_id: "10"
          ringtone_vol: 15
      - service: script.notification_door_bell
        metadata: {}
        data: {}
      - choose:
          - conditions:
              - condition: state
                entity_id: input_boolean.audible_notifications
                state: "on"
            sequence:
              - service: notify.alexa_media_bedroom_speaker
                data:
                  message: |
                    {{ [
                        "Doorbell alert: Someone is at the door! Time to see who's visiting.",
                        "Ding-dong! The doorbell has been pressed. Check to see who's at the door.",
                        "Attention: Doorbell has been pressed. Someone is waiting at the entrance.",
                        "Doorbell chime: A visitor is at the door. Go and greet them!",
                        "Ring, ring! The doorbell has been pressed. Investigate the visitor at the door.",
                        "Visitor alert: The doorbell has been pressed. Time to welcome someone new.",
                        "Doorbell announcement: Someone is at the door. Check and welcome your guest."
                    ] | random }}
          - conditions:
              - condition: state
                entity_id: input_boolean.text_notifications
                state: "on"
            sequence:
              - service: notify.simplemice
                data:
                  message: |
                    {{ [
                        "Doorbell alert: Someone is at the door! Time to see who's visiting.",
                        "Ding-dong! The doorbell has been pressed. Check to see who's at the door.",
                        "Attention: Doorbell has been pressed. Someone is waiting at the entrance.",
                        "Doorbell chime: A visitor is at the door. Go and greet them!",
                        "Ring, ring! The doorbell has been pressed. Investigate the visitor at the door.",
                        "Visitor alert: The doorbell has been pressed. Time to welcome someone new.",
                        "Doorbell announcement: Someone is at the door. Check and welcome your guest."
                    ] | random }}
      - service: select.select_option
        target:
          entity_id: select.wled_matrix_preset
        data:
          option: Black Hole

  - id: prepare_for_sleep
    alias: Notification - Sleep time go to bed
    trigger:
      - platform: time
        at: "21:25:00"
    condition:
      - condition: and
        conditions:
          - condition: state
            entity_id: person.simplemice
            state: home
          - condition: state
            entity_id: binary_sensor.bed_presense
            state: "off"
    action:
      - repeat:
          count: 2
          sequence:
            - service: notify.alexa_media_bedroom_speaker
              data:
                message: |
                  {{ [
                      "Bedtime routine initiated. It is time to wind down and prepare for sleep.",
                      "Nighttime rituals starting: Turning off the laptop, saving work, and getting ready to wash and sleep.",
                      "Attention: Bedtime has begun. Time to wrap up work, turn off the laptop, and prepare for a good nights sleep.",
                      "Bedtime alert! Save your work, turn off the laptop, and get ready to wash and sleep.",
                      "Nighttime preparations underway: Turning off the laptop, saving work, and getting ready for bedtime.",
                      "Sleep mode activated: Save your work, turn off the laptop, and prepare to wash and sleep.",
                      "Goodnight routine started: Turning off the laptop, saving work, and preparing for a restful night.",
                      "Time to unwind: Bedtime is here. Save your work, turn off the laptop, and get ready to sleep.",
                      "Bedtime sequence initiated. Turn off the laptop, save your work, and prepare to wash and sleep.",
                      "Nighttime rituals in progress: Turning off the laptop, saving work, and preparing to wash before sleep."
                  ] | random }}
            - delay:
                hours: 0
                minutes: 5
                seconds: 0
                milliseconds: 0
      - service: script.nightly_briefing
      - delay:
          hours: 0
          minutes: 5
          seconds: 0
          milliseconds: 0
      - service: notify.alexa_media_bedroom_speaker
        data:
          message: Turning off laptop
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: shell_command.screen_lock_micebook
        metadata: {}
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 10
          milliseconds: 0
      - service: shell_command.suspend_micebook
        metadata: {}
        data: {}

script:
